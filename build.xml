<project name="sqljet" default="deploy">

    <property name="build.number" value="local" />

	<target name="clean">

		<!-- First, create directories, which will be removed, 
			otherwise the removal may not be able to 
			if directories don't exist yet -->
		<mkdir dir="build"/>
		<mkdir dir="sqljet/bin"/>
		<mkdir dir="sqljet-test/bin"/>
		
        <delete verbose="true" includeemptydirs="true" failonerror="true">
            <fileset dir="build">
                <include name="**/**" />
            </fileset>
        </delete>

        <delete verbose="true" includeemptydirs="true" failonerror="false">
            <fileset dir="sqljet/bin">
                <include name="**/**" />
            </fileset>
            <fileset dir="sqljet-test/bin">
                <include name="**/**" />
            </fileset>
        </delete>
		
    </target>

    <target name="compile">
        <mkdir dir="sqljet/bin" />
        <mkdir dir="sqljet-test/bin" />

        <javac destdir="sqljet/bin" srcdir="sqljet/src" debug="true"/>
        <javac destdir="sqljet-test/bin" srcdir="sqljet-test/src" debug="true">
            <classpath path="sqljet/bin" />
            <classpath>
            	<fileset dir="sqljet-test/lib" includes="*.jar"/>
            </classpath>
        </javac>
    </target>
    
    <target name="deploy" depends="clean, compile">
        <mkdir dir="build" />
        <jar destfile="build/sqljet.${build.number}.jar">
            <fileset dir="sqljet/bin">
                <include name="**/**"/>
            </fileset>
        </jar>
    </target>

	<target name="test" depends="deploy">
		<junit>
			<jvmarg value="-ea"/>			
			<jvmarg value="-Xmx128m"/>			
			<formatter type="plain" usefile="false" />
			<classpath path="sqljet/bin" />
            <classpath path="sqljet-test/bin" />
            <classpath>
            	<fileset dir="sqljet-test/lib" includes="*.jar"/>
            </classpath>
			<batchtest fork="yes" todir="sqljet-test/bin">
			    <fileset dir="sqljet-test/src">
			      <include name="**/*Test*.java"/>
			      <exclude name="**/*Abstract*.java"/>
			      <exclude name="**/*Mock*.java"/>
			    </fileset>
			 </batchtest>
			<sysproperty key="SQLJET_FILE_LOG" value="false"/>
			<sysproperty key="SQLJET_FILE_PERFORMANCE_LOG" value="false"/>
			<sysproperty key="SQLJET_PAGER_LOG" value="false"/>
			<sysproperty key="SQLJET_TESTS_LOGGING" value="false"/>
			<sysproperty key="SqlJetBtreeTableTest.deleteCopy" value="true"/>
		</junit>
	</target>
	
</project>